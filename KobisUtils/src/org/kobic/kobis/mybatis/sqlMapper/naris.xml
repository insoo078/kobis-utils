<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.kobic.kobis.naris.mapper.NarisMapper">
	<resultMap id="D1CommonMap" 					type="org.kobic.kobis.main.vo.D1CommonVO">
		<id column="inst_id"			property="uid"/>
		<id column="accession_num"		property="access_num"/>
		<id column="ins_cd"				property="ins_cd"/>
		<id column="message"			property="message"/>
		<id column="ins_user_email"		property="ins_user_email"/>
		<id column="img_url_1"			property="img_url_1"/>
		<id column="keywords"			property="keywords"/>
		<id column="sequence"			property="sequence"/>
		<id column="accession_no"		property="accession_no"/>
		<id column="gene_name"			property="gene_name"/>
		<id column="detail_url"			property="detail_url"/>
		<id column="category_3"			property="category_3"/>
		<id column="category_2"			property="category_2"/>
		<id column="category_1"			property="category_1"/>
		<id column="institution"		property="institution"/>
		<id column="taxonomy"			property="taxonomy"/>
		<id column="variety_name"		property="variety_name"/>
		<id column="line_name"			property="line_name"/>
		<id column="in_species_name"	property="in_species_name"/>
		<id column="in_species_type"	property="in_species_type"/>
		<id column="kor_name"			property="kor_name"/>
		<id column="common_name"		property="common_name"/>
		<id column="synonym"			property="synonym"/>
		<id column="species"			property="species"/>
		<id column="subgenus"			property="subgenus"/>
		<id column="genus"				property="genus"/>
		<id column="family"				property="family"/>
	</resultMap>

	<select id="getTotalCount" resultType="java.lang.Integer">
		SELECT COUNT(*) FROM transform.common
	</select>

	<select id="getNarisDataList" resultMap="D1CommonMap" parameterType="java.util.Map">
		SELECT
			0 as uid
			, a.*
			, '' as common_name
			, '' as line_name
			, '' as taxonomy
			, 'INS00007' as ins_cd
		FROM transform.common a
		LIMIT #{pagingIndex}, #{paging}
	</select>
	
	<select id="getSpeciesKorNameInfo" resultType="org.kobic.kobis.naris.vo.NarisSpeciesInfoVO" parameterType="java.util.Map">
		SELECT * FROM transform.Sheet3
		WHERE MATCH(genus, species) AGAINST( #{scientific_name} )
		HAVING CONCAT(genus, ' ', species)=#{scientific_name}
	</select>
	
	<select id="getScientificNameGroupByGenusWithSpecies" resultType="java.lang.String" parameterType="java.util.Map">
		<![CDATA[
			SELECT CONCAT(genus, ' ', species) FROM transform.common
			WHERE CONCAT(genus, species) <> ''
			GROUP BY genus, species
		]]>
	</select>

	<update id="updateKorNameWithInspeciesName" parameterType="java.util.Map">
		UPDATE transform.common
			SET
				kor_name=#{kor_name}
				, in_species_name=#{in_species_name}
		WHERE CONCAT(genus, ' ', species)=#{scientific_name}
	</update>
</mapper>